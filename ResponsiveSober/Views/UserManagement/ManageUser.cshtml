@model SoberModel.AccountModel
@{
    ViewBag.Title = "Manage User";
    Layout = "~/Views/Shared/_Master.cshtml";
}

<script src="~/Scripts/responsive-tabs.js"></script>

<div class="content white-bg">
    <div class="container">

        @*TABS*@
        <ul class="nav nav-tabs responsive" id="myTab">

            @if (Model.HasEnhacedProfiles())
            {
                <li class="active"><a href="#profiles" data-toggle="tab">Edit Profiles</a></li>
            }

            <li><a href="#account" data-toggle="tab">Manage Account</a></li>
        </ul>

        @*Content of each tab*@
        <div class="tab-content responsive">
            @if (Model.HasEnhacedProfiles())
            {
                <div class="tab-pane active" id="profiles">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>Page Name</th>
                                    <th>Enhanced Profile</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.GetProfiles())
                                {
                                    <tr>
                                        <td>
                                            <a href="@Url.Action("profile", "directory", new { @rehab = item.PageName.ToLower(), @city = item.location_city.ToLower(), @state = item.location_state.ToLower(), @facility_type = item.surveyTypeShort })">
                                                @item.PageName
                                            </a>
                                        </td>
                                        <td>
                                            @if (item.surveyTypeShort == "tc")
                                            {
                                                <a href="@Url.Action("editsamhsatreatmentcenter", "directory", new { @listingid = item.ListingId, @page_name = item.PageName.ToLower() })" class="btn btn-primary">Edit Treatment Center</a>
                                            }
                                            else
                                            {
                                                <a href="@Url.Action("editsamhsasoberliving", "directory", new { @listingid = item.ListingId, @page_name = item.PageName.ToLower() })" class="btn btn-primary">Edit Sober Living</a>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>    
            }           

            <div class="tab-pane" id="account">
                <h1>Manage Account</h1>

                @using (Html.BeginForm("ManageUser", "UserManagement", FormMethod.Post))
                {                    
                    if (ViewBag.Message == null)
                    {
                        @Html.HiddenFor(m => m.userProfile.UserId)
                        @Html.HiddenFor(m => m.userProfile.UserLoginEmail)                        

                        <div class="row">
                            <div class="col-md-12 form-group">
                                <label>Login Email:</label>
                                <label>@Model.userProfile.UserLoginEmail</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 form-group">
                                <label>Display Name:</label>
                                @Html.TextBoxFor(m => Model.userProfile.DisplayName, new { @class = "form-control" })
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 form-group">
                                @if (User.IsInRole("Admin"))
                                {
                                    <label>Role:</label>

                                    SoberBLL.AccountManager bllAcct = new SoberBLL.AccountManager();
                                    var roles = bllAcct.GetAllRoles();

                                    @Html.DropDownListFor(m => Model.userProfile.RoleId, new SelectList(roles, "RoleId", "RoleName"), new { @class = "selectpicker" })
                                }
                                else
                                {
                                    @Html.HiddenFor(m => Model.userProfile.RoleId)
                                }
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                @if (Model.user != null)
                                {
                                    @Html.ActionLink("Change Password", "ResetPassword", new { id = Model.user.ConfirmToken })
                                }
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2">
                                <button id="updDisplayname" value="Search" type="submit" class="btn btn-primary">Update</button>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="row">
                            <div class="col-md-12">
                                @if (ViewBag.Message == "Success")
                                {
                                    <h1>Update Successful..</h1>
                                    <p>Your information have been successfully updated.</p>
                                }
                                else
                                {
                                    <h1>Update Failure</h1>
                                    <p>There was a problem updating your information.</p>
                                }
                            </div>
                        </div>
                    }

                }
            </div>
        </div>        
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        if (!$('#profiles').length) {
            $('a[href="#account"]').click();
        }
    });
</script>